import{I as h}from"./index-BOAzHGzj.js";import{S as e}from"./sweetalert2.esm.all-89IKscqO.js";import{a as M}from"./index-t--hEgTQ.js";document.addEventListener("DOMContentLoaded",()=>{const w=document.getElementById("form-enviar-compra"),y=document.getElementById("step-1"),I=document.getElementById("step-2"),g=document.getElementById("input-link"),C=document.getElementById("api-session"),O=document.getElementById("nome-titular"),x=document.getElementById("numero-cartao"),S=document.getElementById("expiracao-cartao"),T=document.getElementById("cvv-cartao"),L=document.getElementById("grade-tamanhos"),_=document.getElementById("div-tamanhos"),v=document.getElementById("parcelas-cartao"),N=document.getElementById("produto-foto"),A=document.getElementById("produto-nome");let f="",E="",r=null,b={},B=1;h(x,{mask:"0000 0000 0000 0000"}),h(S,{mask:"00/0000"}),h(T,{mask:"000"}),window.nextStep=function(){var i;const d=g.value.trim(),a=C.value.trim();if(!d){e.fire("Erro","Informe o link do produto.","error");return}if(!a){e.fire("Erro","Informe a API Session.","error");return}try{r=JSON.parse(a)}catch{e.fire("Erro","O campo API Session deve conter um Nike Session válido.","error");return}if(!r.x_client_token||!r.accessToken||!((i=r.user)!=null&&i.email)){e.fire("Erro","A sessão está incompleta: falta x_client_token, accessToken ou email.","error");return}if(!r.accessTokenExpires){e.fire("Erro",'A sessão não contém o campo "accessTokenExpires".',"error");return}const c=new Date(r.accessTokenExpires);if(isNaN(c.getTime())){e.fire("Erro",'O campo "accessTokenExpires" não é uma data válida.',"error");return}const s=new Date,l=new Date(s.getFullYear(),s.getMonth(),s.getDate(),10,3,0);if(c<l){e.fire("Erro","O accessToken expira antes do lançamento de hoje. Relogue para renovar o token.","error");return}if(!f||!E){e.fire("Erro","Selecione o tamanho do produto antes de continuar.","error");return}y.classList.add("hidden"),I.classList.remove("hidden")},window.backStep=function(){I.classList.add("hidden"),y.classList.remove("hidden")},document.getElementById("btn-buscar-produto").addEventListener("click",async()=>{var a,c,s,l,i,m,k,p;const d=g.value.trim();if(!d){e.fire("Erro","Informe o link do produto.","error");return}e.fire({title:"Buscando produto...",allowOutsideClick:!1,didOpen:()=>{e.showLoading()}});try{const n=(l=(s=(c=(a=(await M.post("/produto/monitorar",{link:d})).data)==null?void 0:a.json)==null?void 0:c.props)==null?void 0:s.pageProps)==null?void 0:l.product;if(e.close(),!n||!n.name||!((i=n.sizes)!=null&&i.length)){e.fire("Erro","Produto não encontrado ou dados incompletos.","error");return}b={},f="",E="",N.src=((k=(m=n.images)==null?void 0:m[0])==null?void 0:k.url)||"",A.textContent=n.name,L.innerHTML="",n.sizes.forEach(o=>{if(!(o!=null&&o.sku)||!(o!=null&&o.description))return;b[o.description]=o.sku;const t=document.createElement("button");t.type="button",t.className="bg-gray-800 text-white text-sm p-2 rounded text-center hover:bg-green-700 transition",t.textContent=o.description,t.dataset.sku=o.sku,t.dataset.tamanho=o.description,t.addEventListener("click",()=>{document.querySelectorAll("#grade-tamanhos button").forEach(D=>D.classList.remove("bg-green-600")),t.classList.add("bg-green-600"),f=o.sku,E=o.description}),L.appendChild(t)}),_.classList.remove("hidden"),v.innerHTML='<option value="">Selecione</option>',B=1,(p=n.installments)!=null&&p.length&&(B=Math.max(...n.installments.map(o=>parseInt(o.quantity))),n.installments.forEach(o=>{const t=document.createElement("option");t.value=o.quantity,t.textContent=`${o.quantity}x de R$ ${o.valueFormatted}`,v.appendChild(t)}))}catch(u){console.error(u),e.close(),e.fire("Erro","Erro ao buscar o produto.","error")}}),w.addEventListener("submit",async d=>{var p;d.preventDefault();const a=O.value.trim();if(!a){e.fire("Erro","Informe o nome do titular.","error");return}const c=document.getElementById("bandeira-cartao").value,s=x.value.replace(/\s/g,""),l=S.value,i=T.value,m=parseInt(v.value),k={link:g.value.trim(),sku:f,tamanho:E,x_client_token:r.x_client_token,access_token:r.accessToken,email_nike:((p=r.user)==null?void 0:p.email)||"",cartao:{nome_titular:a,bandeira:c,numero:s,validade:l,cvv:i,parcelas:m}};e.fire({title:"Enviando compra...",allowOutsideClick:!1,didOpen:()=>{e.showLoading()}});try{const u=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),n=await fetch("/request/drop",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":u},body:JSON.stringify(k)});e.close(),n.ok?e.fire("Sucesso","Compra enviada com sucesso.","success").then(()=>location.reload()):e.fire("Erro","Erro ao enviar a compra.","error")}catch(u){console.error(u),e.close(),e.fire("Erro","Erro de comunicação.","error")}})});
