import{S as t}from"./sweetalert2.esm.all-89IKscqO.js";import{a as N}from"./index-t--hEgTQ.js";document.addEventListener("DOMContentLoaded",()=>{const P=document.getElementById("btn-adicionar"),g=document.getElementById("modal-monitoramento"),S=document.getElementById("input-link"),q=document.getElementById("btn-buscar"),T=document.getElementById("produto-nome"),_=document.getElementById("produto-foto"),w=document.getElementById("grade-tamanhos"),$=document.getElementById("conteudo-produto"),L=document.getElementById("produto-parcelas"),x=document.getElementById("produto-nome-hidden"),C=document.getElementById("produto-foto-url"),M=document.getElementById("produto-codigo_estilo"),O=document.getElementById("tamanhosSelecionados");let r=new Set,h={},b=1;P.addEventListener("click",()=>{g.classList.remove("hidden")}),q.addEventListener("click",()=>{const e=S.value.trim();e&&z(e)}),document.getElementById("btn-selecionar-todos").addEventListener("click",()=>{document.querySelectorAll("#grade-tamanhos div").forEach(e=>{r.add(e.dataset.valor),e.classList.add("bg-green-600")}),B()}),document.getElementById("btn-limpar-selecao").addEventListener("click",()=>{r.clear(),document.querySelectorAll("#grade-tamanhos div").forEach(e=>{e.classList.remove("bg-green-600")}),B()});async function z(e){var v,l,m,u,f,E,y,i;t.fire({title:"Buscando produto...",allowOutsideClick:!1,didOpen:()=>{t.showLoading()}});try{const o=(u=(m=(l=(v=(await N.post("/produto/monitorar",{link:e})).data)==null?void 0:v.json)==null?void 0:l.props)==null?void 0:m.pageProps)==null?void 0:u.product;if(t.close(),!o||!o.name||!((f=o.sizes)!=null&&f.length)){t.fire("Erro","Produto não encontrado ou dados incompletos.","error");return}const k=o.name,n=((E=o.colorInfo)==null?void 0:E.styleCode)||"",c=((y=o.colorInfo)==null?void 0:y.code)||"",j=`https://imgnike-a.akamaihd.net/1300x1300/${o.code||""}${c}.jpg`;T.textContent=k,_.src=j,$.classList.remove("hidden"),x.value=k,C.value=j,M.value=n,w.innerHTML="",r.clear(),h={},o.sizes.forEach(s=>{const a=s==null?void 0:s.description,I=s==null?void 0:s.sku;if(!a||!I)return;h[a]=I;const d=document.createElement("div");d.textContent=a,d.className="bg-gray-800 text-white text-sm p-2 text-center rounded cursor-pointer hover:bg-green-700",d.dataset.valor=a,d.dataset.sku=I,d.addEventListener("click",()=>{r.has(a)?(r.delete(a),d.classList.remove("bg-green-600")):(r.add(a),d.classList.add("bg-green-600")),B()}),w.appendChild(d)}),L.innerHTML='<option value="">Selecione</option>',b=1,(i=o.installments)!=null&&i.length&&(b=Math.max(...o.installments.map(s=>parseInt(s.quantity))),o.installments.forEach(s=>{const a=document.createElement("option");a.value=s.quantity,a.textContent=`${s.quantity}x de R$ ${s.valueFormatted}`,L.appendChild(a)}))}catch(p){console.error(p),t.close(),t.fire("Erro","Não foi possível buscar o produto.","error")}}function B(){O.value=[...r].join(";")}document.getElementById("btn-salvar-monitoramento").addEventListener("click",async()=>{const e=x.value,v=C.value,l=M.value,m=O.value,u=L.value,f=S.value.trim(),E=m.split(";").map(n=>n.trim()).filter(Boolean),y=Object.keys(h).join(";"),i=[],p={};for(const[n,c]of Object.entries(h))p[c]=n,E.includes(n)&&i.push(c);const o=i.join(","),k=JSON.stringify(p);if(!e||!l||!u||i.length===0){t.fire("Erro","Preencha todos os dados antes de salvar.","error");return}t.fire({title:"Salvando monitoramento...",allowOutsideClick:!1,didOpen:()=>{t.showLoading()}});try{await N.post("/monitoramento",{nome:e,foto:v,codigo_estilo:l,tamanhos:m,tamanhos_disponiveis:y,parcelas:u,all_sku:k,sku:o,link:f,parcelas_max:b}),t.close(),t.fire("Sucesso","Monitoramento salvo com sucesso.","success").then(()=>{location.reload()})}catch(n){console.error(n),t.close();let c="Não foi possível salvar o monitoramento.";n.response&&n.response.data&&n.response.data.message&&(c=n.response.data.message),t.fire("Erro",c,"error")}}),window.addEventListener("click",e=>{e.target===g&&g.classList.add("hidden")}),window.addEventListener("keydown",e=>{e.key==="Escape"&&g.classList.add("hidden")})});
